# HTTP和ＨTTPS区别(HTTPS加密原理)

超文本传输协议HTTP协议被用于在Web浏览器和网站服务器之间传递信息，HTTP协议以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，就可以直接读懂其中的信息，因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息。

为了解决HTTP协议的这一缺陷，需要使用另一种协议：安全套接字层超文本传输协议HTTPS，为了数据传输的安全，HTTPS在HTTP的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，并为浏览器和服务器之间的通信加密。

## **HTTP和HTTPS的基本概念**

HTTP：是互联网上应用最为广泛的一种网络协议，是一个客户端和服务器端请求和应答的标准（TCP），用于从WWW服务器传输超文本到本地浏览器的传输协议，它可以使浏览器更加高效，使网络传输减少。

HTTPS：是以安全为目标的HTTP通道，简单讲是HTTP的安全版，即HTTP下加入SSL层，HTTPS的安全基础是SSL，因此加密的详细内容就需要SSL。

HTTPS协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。

## **HTTP与HTTPS有什么区别？**

HTTP协议传输的数据都是未加密的，也就是明文的，因此使用HTTP协议传输隐私信息非常不安全，为了保证这些隐私数据能加密传输，于是网景公司设计了SSL（Secure Sockets Layer）协议用于对HTTP协议传输的数据进行加密，从而就诞生了HTTPS。

![](/home/xsh/桌面/markdown/imgs/a480d891b7240325055da1e6b2f75ac3.png)

简单来说，HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全。

HTTPS和HTTP的区别主要如下：

1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

## **HTTPS的工作原理**

我们都知道HTTPS能够加密信息，以免敏感信息被第三方获取，所以很多银行网站或电子邮箱等等安全级别较高的服务都会采用HTTPS协议。

![](/home/xsh/桌面/markdown/imgs/958f7437a8245ba344750428ba0102e7.png)



### **客户端发起HTTPS请求**

### **服务端的配置**

采用HTTPS协议的服务器必须要有一套数字证书，可以自己制作，也可以向组织申请，区别就是自己颁发的证书需要客户端验证通过，才可以继续访问，而使用受信任的公司申请的证书则不会弹出提示页面(startssl就是个不错的选择，有1年的免费服务)。

这套证书其实就是一对公钥和私钥，如果对公钥和私钥不太理解，可以想象成一把钥匙和一个锁头，只是全世界只有你一个人有这把钥匙，你可以把锁头给别人，别人可以用这个锁把重要的东西锁起来，然后发给你，因为只有你一个人有这把钥匙，所以只有你才能看到被这把锁锁起来的东西。

### **传送证书**

这个证书其实就是公钥，只是包含了很多信息，如证书的颁发机构，过期时间等等。

### **客户端解析证书**

这部分工作是有客户端的TLS来完成的，首先会验证公钥是否有效，比如颁发机构，过期时间等等，如果发现异常，则会弹出一个警告框，提示证书存在问题。

如果证书没有问题，那么就生成一个随机值，然后用证书对该随机值进行加密，就好像上面说的，把随机值用锁头锁起来，这样除非有钥匙，不然看不到被锁住的内容。



### **服务段解密信息**

服务端用私钥解密后，得到了客户端传过来的随机值(私钥)，然后把内容通过该值进行对称加密，所谓对称加密就是，将信息和私钥通过某种算法混合在一起，这样除非知道私钥，不然无法获取内容，而正好客户端和服务端都知道这个私钥，所以只要加密算法够彪悍，私钥够复杂，数据就够安全。



### **传输加密后的信息**

这部分信息是服务段用私钥加密后的信息，可以在客户端被还原。

### **客户端解密信息**

客户端用之前生成的私钥解密服务段传过来的信息，于是获取了解密后的内容，整个过程第三方即使监听到了数据，也束手无策。

## **HTTPS要比HTTP多用多少服务器资源**

HTTPS其实就是建构在SSL/TLS之上的 HTTP协议，所以，要比较HTTPS比HTTP多用多少服务器资源，马海祥认为主要看SSL/TLS本身消耗多少服务器资源。

![](/home/xsh/桌面/markdown/imgs/8c87bfa5db8892f76d4eefbbfc90a9de.png)

HTTP使用TCP三次握手建立连接，客户端和服务器需要交换3个包;HTTPS除了TCP的三个包，还要加上ssl握手需要的9个包，所以一共是12个包。

HTTP建立连接，按照下面链接中针对Computer Science House的测试，是114毫秒；HTTPS建立连接，耗费436毫秒，ssl部分花费322毫秒，包括网络延时和ssl本身加解密的开销（服务器根据客户端的信息确定是否需要生成新的主密钥；服务器回复该主密钥，并返回给客户端一个用主密钥认证的信息；服务器向客户端请求数字签名和公开密钥）。

当SSL连接建立后，之后的加密方式就变成了3DES等对于CPU负荷较轻的对称加密方式，相对前面SSL建立连接时的非对称加密方式，对称加密方式对CPU的负荷基本可以忽略不记，所以问题就来了，如果频繁的重建ssl的session，对于服务器性能的影响将会是致命的，尽管打开HTTPS保活可以缓解单个连接的性能问题，但是对于并发访问用户数极多的大型网站，基于负荷分担的独立的SSL termination proxy就显得必不可少了，Web服务放在SSL termination proxy之后，SSL termination proxy既可以是基于硬件的，譬如F5；也可以是基于软件的，譬如[维基百科](https://link.juejin.im/?target=https%3A%2F%2Fm.baidu.com%2Fs%3Fword%3D%25E7%25BB%25B4%25E5%259F%25BA%25E7%2599%25BE%25E7%25A7%2591%26from%3D1011904q%26fenlei%3Dmv6quAkxIv-1ufKYIHdsIHDsnj0Yr0K15H63ujw-rAckP1whPjwWnH60mv4YUWYknj0sPj9xuZPs0ZNzUjdCIZwsrBtEILILQhd9pA7GXA-9UhT8mv3Epy4YugF8ugfEnHc1nz4CIAd_)用到的就是Nginx。

## **HTTPS的优点**

正是由于HTTPS非常的安全，攻击者无法从中找到下手的地方，从站长的角度来说，HTTPS的优点有以下2点：

### **1、SEO方面**

谷歌曾在2014年8月份调整搜索引擎算法，并称“比起同等HTTP网站，采用HTTPS加密的网站在搜索结果中的排名将会更高”。

### **2、安全性**

尽管HTTPS并非绝对安全，掌握根证书的机构、掌握加密算法的组织同样可以进行中间人形式的攻击，但HTTPS仍是现行架构下最安全的解决方案，主要有以下几个好处：

1）、使用HTTPS协议可认证用户和服务器，确保数据发送到正确的客户机和服务器；

（2）、HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，要比http协议安全，可防止数据在传输过程中不被窃取、改变，确保数据的完整性。

（3）、HTTPS是现行架构下最安全的解决方案，虽然不是绝对安全，但它大幅增加了中间人攻击的成本。

## **HTTPS的缺点**

虽然说HTTPS有很大的优势，但其相对来说，还是有些不足之处的，具体来说，有以下2点：

**1、SEO方面**

据ACM CoNEXT数据显示，使用HTTPS协议会使页面的加载时间延长近50%，增加10%到20%的耗电，此外，HTTPS协议还会影响缓存，增加数据开销和功耗，甚至已有安全措施也会受到影响也会因此而受到影响。

而且HTTPS协议的加密范围也比较有限，在黑客攻击、拒绝服务攻击、服务器劫持等方面几乎起不到什么作用。

最关键的，SSL证书的信用链体系并不安全，特别是在某些国家可以控制CA根证书的情况下，中间人攻击一样可行。

**2、经济方面**

（1）、SSL证书需要钱，功能越强大的证书费用越高，个人网站、小网站没有必要一般不会用。

（2）、SSL证书通常需要绑定IP，不能在同一IP上绑定多个域名，IPv4资源不可能支撑这个消耗（SSL有扩展可以部分解决这个问题，但是比较麻烦，而且要求浏览器、操作系统支持，Windows XP就不支持这个扩展，考虑到XP的装机量，这个特性几乎没用）。

（3）、HTTPS连接缓存不如HTTP高效，大流量网站如非必要也不会采用，流量成本太高。

（4）、HTTPS连接服务器端资源占用高很多，支持访客稍多的网站需要投入更大的成本，如果全部采用HTTPS，基于大部分计算资源闲置的假设的VPS的平均成本会上去。

（5）、HTTPS协议握手阶段比较费时，对网站的相应速度有负面影响，如非必要，没有理由牺牲用户体验。

## SSL工作原理(加密原理)

### SSL加密类型

#### 对称密钥加密

又称私钥加密、共享密钥加密。需要对加密和解密使用相同密钥的加密算法。由于其速度快，对称性加密通常在消息发送方需要加密大量数据时使用。对称性加密也称为密钥加密

##### 优点：性能高

##### 缺点：密钥泄露风险高

因为大家共享一个密钥，假如一方泄露这个密码，就没有安全可言。比如：在前后端调用的过程中使用此种算法，如果前端js中存放密钥，那么就会被窃取，app端也有可能反编译获取。

常用的算法：DES、3DES、AES、Blowfish、IDEA、RC5、RC6

![](/home/xsh/桌面/markdown/imgs/164561a55e44c382.png)

#### 公开密钥加密

（英语：public-key cryptography，又译为公开密钥加密）,也称为非对称加密（asymmetric cryptography），在这种密码学方法中，需要一对密钥，一个是私人密钥，另一个则是公开密钥

##### 优点：知道了公钥，也无法计算出来密钥。例如：在开发项目时，一般私钥是保存在服务端，公钥保存在前端，只要服务端安全，那么私钥就不会被窃取。

##### 缺点：计算量大，需要消耗大量的系统资源，性能低。

常用的算法：[RSA](https://link.juejin.im/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FRSA)、[Elgamal](https://link.juejin.im/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FElgamal)、背包算法、Rabin、D-H、[ECC](https://link.juejin.im/?target=https%3A%2F%2Fbaike.baidu.com%2Fitem%2FECC)（椭圆曲线加密算法）。

![](/home/xsh/桌面/markdown/imgs/164561a583d36cc9.png)

#### 数字签名

数字签名主要是有两个作用

- 身份证明
- 验证信息的内容是否被篡改

而数字签名因为采用公钥加密技术实现，又叫公钥数字签名。

### HTTPS采用混合加密

HTTPS经由[HTTP](https://link.juejin.im?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2FHTTP)进行通信，但利用[SSL/TLS](https://link.juejin.im?target=https%3A%2F%2Fzh.wikipedia.org%2Fwiki%2F%25E4%25BC%25A0%25E8%25BE%2593%25E5%25B1%2582%25E5%25AE%2589%25E5%2585%25A8)来加密数据包,而SSL/TLS的加密方式就是采用了对称加密与非对称加密的结合。

SSL/TLS考虑到非对称加密的性能较低，所以在初始协商对称加密密钥时，使用了非对称加密，当对称加密密钥协商完成后，则后续所有的通讯，全部采用对称加密进行通讯。

### HTTPS通信流程(9次tcp包)

![](/home/xsh/桌面/markdown/imgs/164c80498691df3f.png)



上图大致描述了 SSL/TLS 的握手过程,具体细节如下：



##### Client Hello(客－>服发送户端支持的加密套件（Support Ciphers）和 SSL Version 等信息,random1)

握手第一步是客户端向服务端发送 Client Hello 消息，这个消息里包含了一个客户端生成的随机数 Random1、客户端支持的加密套件（Support Ciphers）和 SSL Version 等信息。通过 Wireshark 抓包，我们可以看到如下信息：

![](/home/xsh/桌面/markdown/imgs/164c804986c9e110.png)



##### Server Hello(服－>客发送Random2)

第二步是服务端向客户端发送 Server Hello 消息，这个消息会从 Client Hello 传过来的 Support Ciphers 里确定一份加密套件，这个套件决定了后续加密和生成摘要时具体使用哪些算法，另外还会生成一份随机数 Random2。注意，至此客户端和服务端都拥有了两个随机数（Random1+ Random2），这两个随机数会在后续生成对称秘钥时用到。

![](/home/xsh/桌面/markdown/imgs/164c80498619b340.png)

##### Certificate(服->客发证书(公钥))

这一步是服务端将自己的证书下发给客户端，让客户端验证自己的身份，客户端验证通过后取出证书中的公钥。

![](/home/xsh/桌面/markdown/imgs/164c8049d52db77e.png)

##### Server Hello Done(服->客　结束)

Server Hello Done 通知客户端 Server Hello 过程结束。

![](/home/xsh/桌面/markdown/imgs/164c8049f2d83adb.png)

##### Client Key Exchange(客验证证书,用公钥加密Random3, 发送服)

客户端收到服务端传来的证书后，先从 CA 验证该证书的合法性，验证通过后取出证书中的服务端公钥，再生成一个随机数 Random3，再用服务端公钥非对称加密 Random3生成 PreMaster Key。

Client Key Exchange 就是将这个 key 传给服务端，服务端再用自己的私钥解出这个 PreMaster Key 得到客户端生成的 Random3。至此，客户端和服务端都拥有 Random1 + Random2 + Random3，两边再根据同样的算法就可以生成一份秘钥，握手结束后的应用层数据都是使用这个秘钥进行对称加密。为什么要使用三个随机数呢？这是因为 SSL/TLS 握手过程的数据都是明文传输的，并且多个随机数种子来生成秘钥不容易被暴力破解出来。客户端将 PreMaster Key 传给服务端的过程如下图所示：

![](/home/xsh/桌面/markdown/imgs/164c8049e0d09d8e.png)

##### Change Cipher Spec(Client)(后面消息都用前面公钥加密后的密钥　客->服)



这一步是客户端通知服务端后面再发送的消息都会使用前面协商出来的秘钥加密了，是一条事件消息。

![](/home/xsh/桌面/markdown/imgs/164c8049e0d91520.png)

##### Encrypted Handshake Message(Client)(这是一条加密消息测试　客－>服)

这一步对应的是 Client Finish 消息，客户端将前面的握手消息生成摘要再用协商好的秘钥加密，这是客户端发出的第一条加密消息。服务端接收后会用秘钥解密，能解出来说明前面协商出来的秘钥是一致的。

![](/home/xsh/桌面/markdown/imgs/164c8049e44ae9c8.png)

##### Change Cipher Spec(Server)(后续都用密钥加密　服->客)

这一步是服务端通知客户端后面再发送的消息都会使用加密，也是一条事件消息。

##### Encrypted Handshake Message(Server)(这是一条加密　服->客)

这一步对应的是 Server Finish 消息，服务端也会将握手过程的消息生成摘要再用秘钥加密，这是服务端发出的第一条加密消息。客户端接收后会用秘钥解密，能解出来说明协商的秘钥是一致的

　



![](/home/xsh/桌面/markdown/imgs/164c8049ec3e774b.png)

共9次

3个阶段

１.阶段商量加密套件,交换random1,2

 2.非对称加密　之后用到的密钥

 3.互相测试密钥加密